# Introduction


## {background-image="images/bird.png"}

## Introduction


:::: {.columns}

::: {.column .center width=50%}
![](images/occ.png){width=80%}
:::

::: {.column width=50%}
- first published by @mackenzie2002 in the context of species occurrence modelling
- many extensions: dynamic occupancy [@mackenzie_estimating_2003], multiple species [@rota_multispecies_2016], continuous detection process [@mackenzie_estimating_2003]...
- Here: original simple occupancy model.

:::

::::

# Simple occupancy model



## Model


:::: {.columns}

::: {.column width=100%}
For site $i$ and visit $j$:
$$
y_{ij} \sim Bern(z_i~p)
$$
$$
z_i \sim Bern(\psi)
$$ 
:::

::: {.column .center width=100%}
![](images/diagram.png){width=80%}
:::

::::

# Occupancy models in R

## Simulation code

```{r}
set.seed(42)

M <- 100 # number of sites
p <- 0.4 # detection probability
psi <- 0.8 # occupancy

# Simulate a number of visits for each site
nvisit <- rpois(n = M, lambda = 3)
nvisit[nvisit == 0] <- 1 # Don't allow zero visits

# Initialize vectors
z <- vector(mode = "numeric", length = M)
y <- vector(mode = "list", length = M)

for (i in 1:M) { # for each site
  # Simulate true presence/absence at site i
  zi <- rbinom(n = 1, size = 1, prob = psi)
  
  # Simulate observed presence/absence at site i for all visits
  yij <- rbinom(n = nvisit[i], 
                size = 1, prob = p*zi)
  
  z[i] <- zi # True sites states
  y[[i]] <- yij # Detections
}
```

## Simulation code

- True proportion of occupied sites ($z_i = 1$)
```{r}
sum(z)/M
```
- Proportion of sites with at least one detection (naive occupancy)
```{r}
sum(sapply(y, function(yi) any(yi != 0)))/M
```

## Inference hypotheses

::: {.fragment}
1.   Repeated visits (parameter identifiability).
:::
::: {.fragment}
2.   The site remains in the same state during the entire study period (closure assumption).
:::
::: {.fragment}
3.   There are no false detections.
:::

## Inference with `unmarked`

[`unmarked`](https://rbchan.github.io/unmarked/): occupancy inference in R using maximum likelihood estimation (frequentist statistics).

## Format data

```{r}
library(unmarked)

# Format the list of observed detections y
max_visit <- max(sapply(y, length)) # get maximum number of detections

# Transform y to matrix
y_matrix <- matrix(data = NA,
                   nrow = M,
                   ncol = max_visit)
for (i in 1:M) { # for each site
  nvisit_i <- length(y[[i]]) # get number of visits
  y_matrix[i, 1:nvisit_i] <- y[[i]] # fill n-th first rows with detection history
}

# Each row contains the detections at a site, filled with NAs for 
# sites that have less visits than the most visited one
head(y_matrix, 3)

# Cast y_matrix to unmarkedFrameOccu
y_occu <- unmarked::unmarkedFrameOccu(y_matrix)
head(y_occu, 3)
```

## Inference with `unmarked::occu`

- `formula`: gives the formulas for the logit of $p$ and $\psi$.
- `data`: observed detections

```{r}
# Infer occupancy
occ <- unmarked::occu(formula = ~1 ~1, 
                      data = y_occu)

class(occ)
summary(occ)
```

## Inference with `cmdstanr`

# Resources



## Resources

- [Quarto guide](https://quarto.org/docs/guide/)
- [Markdown syntax](https://quarto.org/docs/authoring/markdown-basics.html)
- [RevealJS guide](https://quarto.org/docs/presentations/revealjs/)

<br>

To use this template, visit the [**Wiki**](https://github.com/biodiversitydata/quarto-template/wiki).
